const path = require('path');

module.exports = {
  // é…ç½®å…¥å£æ–‡ä»¶
  entry: {
    app: './src/index.js',
  },
  // æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£
  output: {
    // å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢
    // 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚
    filename: 'js/[name].[chunkhash:8].bundle.js',
    /**
     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ
     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚
     * path.resolve
     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„
     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz
     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨
     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•
     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥
     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•
     * 
     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„
     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„
     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•
     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥
     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„
     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”
     */
    path: path.resolve(__dirname, '../../dist')
  },
  module: {
    /**
     * test è§„å®šäº†ä½œç”¨äºä»¥è§„åˆ™ä¸­åŒ¹é…åˆ°çš„åç¼€ç»“å°¾çš„æ–‡ä»¶ï¼Œ 
     * use å³æ˜¯ä½¿ç”¨ babel-loader å¿…é¡»çš„å±æ€§ï¼Œ 
     * exclude å‘Šè¯‰æˆ‘ä»¬ä¸éœ€è¦å»è½¬è¯‘"node_modules"è¿™é‡Œé¢çš„æ–‡ä»¶ã€‚
     */
    rules:[
      {
        test: /\.(js|jsx)?$/,
        // å¼€å¯ç¼“å­˜
        options: { cacheDirectory: true },
        loader: 'babel-loader',
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      },
      {
        test: /\.less/,
        use: [
          'style-loader',
          'css-loader',
          'less-loader'
        ]
      }
    ]
  }
}
